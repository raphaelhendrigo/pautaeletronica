version: "3.9"
services:
  pauta:
    build: .
    image: pauta-automation:latest
    ports:
      - "8080:8080"
    environment:
      TZ: "${TZ:-America/Sao_Paulo}"
      BASE_URL: "${BASE_URL:-https://etcm.tcm.sp.gov.br}"

      # Credenciais (defina em variáveis de ambiente ou em um `.env` local; não versione segredos)
      ETCM_USER: "${ETCM_USER:?defina ETCM_USER}"
      ETCM_PASS: "${ETCM_PASS:?defina ETCM_PASS}"

      # Parâmetros do pipeline
      SESSAO: "${SESSAO:-71}"
      DATA_DE: "${DATA_DE:-29/09/2025}"
      DATA_ATE: "${DATA_ATE:-29/10/2025}"
      HEADER_TEMPLATE: "${HEADER_TEMPLATE:-papel_timbrado_tcm.docx}"
      DOWNLOAD_DIR: "${DOWNLOAD_DIR:-/workspace/downloads}"
      OUTPUT_DIR: "${OUTPUT_DIR:-/workspace/output}"
      HEADLESS: "${HEADLESS:-true}"

      # SMTP (defina em variáveis de ambiente ou em um `.env` local)
      SMTP_HOST: "${SMTP_HOST:-smtp.office365.com}"
      SMTP_PORT: "${SMTP_PORT:-587}"
      SMTP_USER: "${SMTP_USER:?defina SMTP_USER}"
      SMTP_PASS: "${SMTP_PASS:?defina SMTP_PASS}"

      # E-mail (opcional; defaults em `server.py`)
      EMAIL_SENDER: "${EMAIL_SENDER:-}"
      EMAIL_TO: "${EMAIL_TO:-}"
      EMAIL_CC: "${EMAIL_CC:-}"
      EMAIL_BCC: "${EMAIL_BCC:-}"
      EMAIL_SUBJECT: "${EMAIL_SUBJECT:-}"
      EMAIL_BODY: "${EMAIL_BODY:-}"

    volumes:
      - ./papel_timbrado_tcm.docx.docx:/app/papel_timbrado_tcm.docx:ro
